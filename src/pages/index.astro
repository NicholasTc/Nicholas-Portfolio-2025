---
import BaseLayout from '../layouts/BaseLayout.astro';
import Navigation from '../components/Navigation.astro';
import Hero from '../components/Hero.astro';
import ProjectsGrid from '../components/ProjectsGrid.astro';
import Footer from '../components/Footer.astro';
---

<BaseLayout title="Nicholas Theodorus Chan — Portfolio">
  <!-- ================== Intro Animation Overlay ================== -->
  <div class="intro-overlay" id="introOverlay">
    <button class="skip-btn" id="skipBtn">Skip Intro</button>

    <!-- Trail Effect -->
    <div class="card-trail" id="cardTrail"></div>

    <!-- Revealed Text -->
    <div class="revealed-text-container">
      <div class="revealed-text" id="revealedText">
        <span>Nicholas' Portfolio</span>
      </div>
    </div>

    <!-- Business Card -->
    <div class="card-container">
      <div class="business-card" id="businessCard">
        <div class="card-logo">N</div>
        <div class="card-name">Nicholas Chan</div>
        <div class="card-title">Software Developer</div>
      </div>
    </div>

    <!-- Sparkles Container -->
    <div class="sparkles" id="sparkles"></div>
  </div>

  <!-- Background Effects -->
  <div class="bg-grid"></div>
  <div class="bg-gradient-orbs">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
        </div>

  <!-- Navigation -->
  <Navigation />

  <!-- Hero Section -->
  <Hero />

  <!-- Projects Section -->
  <ProjectsGrid />

  <!-- ================== About ================== -->
  <section id="about" class="about wrap">
    <h2>About</h2>
    <p class="muted">
      I am a senior CS student at UCSD with internship experience building fast, reliable web apps end-to-end. 
      I've shipped AI résumé tools (Flask + React + MongoDB), built Spring Boot REST APIs with solid validation and low latency, 
      and launched production sites with WordPress/Elementor, JavaScript, and Cloudflare, cutting up load times and errors while collaborating in small teams. 
      I work test-first, write clear docs, and care about clean, practical interfaces. I'm eager to learn, open to feedback, and excited to grow into an SWE/SDE role while exploring scalable backends, 
      workflow automation, and data-aware UX for real users.
    </p>
    <p class="muted"><strong>Skills:</strong> Frontend (React/JS/HTML/CSS, WordPress/Elementor) · Backend (Flask, Spring Boot, Django, Node/Express, PHP) · Data/Infra (MySQL/SQLite, MongoDB, Docker, Cloudflare) · Tools (Git/GitHub, REST APIs, CI, Linux, Bash)</p>
  </section>

  <!-- ================== Contact ================== -->
  <section id="contact">
    <h2>Contact</h2>
    <p class="muted">Email me at <a class="link" href="mailto:nicholastc14@gmail.com">nicholastc14@gmail.com</a>. Currently based in San Diego, CA.</p>
  </section>

  <!-- Footer -->
  <Footer />
</BaseLayout>

<!-- ================== Quick-View Modals ================== -->
<dialog id="m1" class="modal">
  <div class="dialog" role="document" aria-labelledby="m1-title">
    <header>
      <h3 id="m1-title">GymApp — Flask + React</h3>
      <button class="modal-close" data-close="m1" aria-label="Close">✕</button>
    </header>
    <p class="muted">A fitness tracker with exercise builder, weekly insights, and predictions.</p>
    <ul class="list">
      <li>Reduced query time by 42% via indexed joins + caching layer.</li>
      <li>Clean module split: Deck/Player/Game; CI on PRs.</li>
      <li>JWT auth, role-based endpoints, and seed scripts.</li>
    </ul>
    <div class="actions">
      <a class="btn primary" href="#"><span class="shine"></span>Case Study →</a>
      <a class="btn" href="#"><span class="shine"></span>Repository</a>
    </div>
  </div>
</dialog>

<dialog id="m2" class="modal">
  <div class="dialog" role="document" aria-labelledby="m2-title">
    <header>
      <h3 id="m2-title">Pollen Atlas — WP Widget</h3>
      <button class="modal-close" data-close="m2" aria-label="Close">✕</button>
    </header>
    <p class="muted">Elementor widget combining Google Pollen & Air Quality with client-side charts. <strong>In progress for intern work.</strong></p>
    <ul class="list">
      <li>Serverless cache lowered API calls by ~65%.</li>
      <li>ARIA-labelled charts + keyboard navigable legends.</li>
      <li>"Use my location" shortcut with permissions fallback.</li>
    </ul>
    <div class="actions">
      <a class="btn primary" href="#"><span class="shine"></span>Live Demo</a>
      <a class="btn" href="#"><span class="shine"></span>Notes</a>
    </div>
  </div>
</dialog>

<dialog id="m3" class="modal">
  <div class="dialog" role="document" aria-labelledby="m3-title">
    <header>
      <h3 id="m3-title">ResumeAI Tool — OpenAI</h3>
      <button class="modal-close" data-close="m3" aria-label="Close">✕</button>
    </header>
    <p class="muted">AI-powered resume parsing tool with improved accuracy for multiple formats. <strong>In progress for intern work.</strong></p>
    <ul class="list">
      <li>Improved PDF parsing accuracy by 85% using advanced text extraction techniques.</li>
      <li>Supports multiple resume formats including Word, PDF, and plain text documents.</li>
      <li>Integrated OpenAI API for intelligent content analysis and structured data extraction.</li>
    </ul>
    <div class="actions">
      <a class="btn primary" href="#"><span class="shine"></span>Case Study →</a>
      <a class="btn" href="#"><span class="shine"></span>Repository</a>
    </div>
  </div>
</dialog>

<dialog id="m4" class="modal">
  <div class="dialog" role="document" aria-labelledby="m4-title">
    <header>
      <h3 id="m4-title">ProductivityHelper — Task Management</h3>
      <button class="modal-close" data-close="m4" aria-label="Close">✕</button>
    </header>
    <p class="muted">A comprehensive task management application with focus mode, progress tracking, and weekly planning.</p>
    <ul class="list">
      <li>Implemented focus mode for single-task concentration with progress tracking.</li>
      <li>Clean weekly view with drag-and-drop task organization and real-time progress indicators.</li>
      <li>Responsive design with dark theme and intuitive task categorization system.</li>
    </ul>
    <div class="actions">
      <a class="btn primary" href="#"><span class="shine"></span>Live Demo →</a>
      <a class="btn" href="#"><span class="shine"></span>Repository</a>
    </div>
  </div>
</dialog>

<style>
  /* ================== Intro Animation Styles ================== */
  .intro-overlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 50%, #1b263b 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  [data-theme="light"] .intro-overlay {
    background: linear-gradient(135deg, #e0e7ff 0%, #fafbfc 50%, #e8efff 100%);
  }

  .intro-overlay.fade-out {
    animation: overlayFadeOut 0.8s ease-out forwards;
    animation-delay: 0.2s;
  }

  .intro-overlay.hidden {
    display: none;
  }

  @keyframes overlayFadeOut {
    0% { opacity: 1; }
    100% { opacity: 0; pointer-events: none; }
  }

  /* Skip Button */
  .skip-btn {
    position: absolute;
    top: 24px;
    right: 24px;
    padding: 10px 20px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 999px;
    color: rgba(255, 255, 255, 0.7);
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 100;
    backdrop-filter: blur(10px);
    font-family: var(--font-sans);
  }

  .skip-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    color: white;
  }

  [data-theme="light"] .skip-btn {
    background: rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(15, 23, 42, 0.7);
  }

  [data-theme="light"] .skip-btn:hover {
    background: rgba(0, 0, 0, 0.1);
    color: #0f172a;
  }

  /* Revealed Text */
  .revealed-text-container {
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  .revealed-text {
    font-size: clamp(32px, 8vw, 72px);
    font-weight: 700;
    color: white;
    letter-spacing: -0.02em;
    text-align: center;
    opacity: 0;
    clip-path: inset(0 100% 0 0);
    font-family: var(--font-sans);
  }

  [data-theme="light"] .revealed-text {
    color: #0f172a;
  }

  .revealed-text.revealing {
    animation: textReveal 1.2s ease-out forwards;
    animation-delay: 0.3s;
  }

  @keyframes textReveal {
    0% {
      opacity: 0;
      clip-path: inset(0 100% 0 0);
    }
    30% {
      opacity: 1;
    }
    100% {
      opacity: 1;
      clip-path: inset(0 0% 0 0);
    }
  }

  .revealed-text span {
    background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 50%, #60a5fa 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* Business Card */
  .intro-overlay .card-container {
    position: absolute;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    pointer-events: none;
  }

  .business-card {
    position: absolute;
    left: -200px;
    width: 180px;
    height: 110px;
    background: linear-gradient(145deg, #e8efff 0%, #d4e0ff 50%, #c7d7ff 100%);
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4),
      0 0 40px rgba(96, 165, 250, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.5);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transform-style: preserve-3d;
    perspective: 1000px;
  }

  .business-card.rolling {
    animation: cardRoll 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  }

  .business-card.exploding {
    animation: cardExplode 0.7s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  @keyframes cardRoll {
    0% {
      left: -200px;
      transform: rotateY(0deg) rotateZ(0deg);
    }
    100% {
      left: calc(50% - 90px);
      transform: rotateY(1080deg) rotateZ(360deg);
    }
  }

  @keyframes cardExplode {
    0% {
      left: calc(50% - 90px);
      width: 180px;
      height: 110px;
      border-radius: 12px;
      opacity: 1;
      background: linear-gradient(145deg, #e8efff 0%, #d4e0ff 50%, #c7d7ff 100%);
    }
    40% {
      opacity: 0.9;
      border-radius: 24px;
      background: linear-gradient(145deg, #1e3a5f 0%, #0d1b2a 50%, #1b263b 100%);
    }
    100% {
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      border-radius: 0;
      opacity: 0;
      background: linear-gradient(145deg, #06080d 0%, #06080d 100%);
    }
  }

  [data-theme="light"] .business-card.exploding {
    animation: cardExplodeLight 0.7s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  @keyframes cardExplodeLight {
    0% {
      left: calc(50% - 90px);
      width: 180px;
      height: 110px;
      border-radius: 12px;
      opacity: 1;
      background: linear-gradient(145deg, #e8efff 0%, #d4e0ff 50%, #c7d7ff 100%);
    }
    40% {
      opacity: 0.9;
      border-radius: 24px;
      background: linear-gradient(145deg, #fafbfc 0%, #f7f9fc 50%, #ffffff 100%);
    }
    100% {
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      border-radius: 0;
      opacity: 0;
      background: linear-gradient(145deg, #fafbfc 0%, #fafbfc 100%);
    }
  }

  /* Card Content */
  .card-logo {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
    border-radius: 10px;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    font-weight: 800;
    color: white;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    font-family: var(--font-sans);
  }

  .card-name {
    font-size: 14px;
    font-weight: 700;
    color: #1e293b;
    letter-spacing: -0.01em;
    font-family: var(--font-sans);
  }

  .card-title {
    font-size: 9px;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-top: 2px;
    font-family: var(--font-sans);
  }

  /* Card Trail */
  .card-trail {
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    height: 4px;
    background: linear-gradient(90deg,
      transparent 0%,
      rgba(96, 165, 250, 0.1) 20%,
      rgba(96, 165, 250, 0.5) 60%,
      rgba(139, 92, 246, 0.8) 100%
    );
    border-radius: 4px;
    width: 0;
    opacity: 0;
    box-shadow: 0 0 20px rgba(96, 165, 250, 0.5);
  }

  .card-trail.active {
    animation: trailGrow 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  }

  @keyframes trailGrow {
    0% {
      width: 0;
      opacity: 0;
      left: 0;
    }
    20% {
      opacity: 1;
    }
    100% {
      width: calc(50% + 90px);
      opacity: 0.6;
      left: 0;
    }
  }

  /* Sparkles */
  .sparkles {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
  }

  :global(.sparkle) {
    position: absolute;
    width: 6px;
    height: 6px;
    background: #60a5fa;
    border-radius: 50%;
    opacity: 0;
    box-shadow: 0 0 12px rgba(96, 165, 250, 0.8), 0 0 24px rgba(139, 92, 246, 0.4);
  }

  :global(.sparkle:nth-child(odd)) {
    background: #a78bfa;
    box-shadow: 0 0 12px rgba(167, 139, 250, 0.8), 0 0 24px rgba(96, 165, 250, 0.4);
  }

  :global(.sparkle.burst) {
    animation: sparkleBurst 0.9s ease-out forwards;
  }

  @keyframes sparkleBurst {
    0% {
      opacity: 0.9;
      transform: translate(0, 0) scale(1);
    }
    100% {
      opacity: 0;
      transform: translate(var(--tx), var(--ty)) scale(0);
    }
  }

  /* Reduced Motion */
  @media (prefers-reduced-motion: reduce) {
    .intro-overlay {
      display: none !important;
    }
  }
</style>

<script>
  // ================== Intro Animation Controller ================== //
  document.addEventListener('DOMContentLoaded', () => {
    const intro = document.getElementById('introOverlay');
    const card = document.getElementById('businessCard');
    const trail = document.getElementById('cardTrail');
    const text = document.getElementById('revealedText');
    const sparkles = document.getElementById('sparkles');
    const skipBtn = document.getElementById('skipBtn');

    if (!intro) return; // Exit if not on homepage

    let animationComplete = false;

    // Create sparkle particles
    function createSparkles() {
      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;

      for (let i = 0; i < 20; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.style.left = centerX + 'px';
        sparkle.style.top = centerY + 'px';

        const angle = (Math.PI * 2 * i) / 20 + Math.random() * 0.5;
        const distance = 100 + Math.random() * 200;
        const tx = Math.cos(angle) * distance;
        const ty = Math.sin(angle) * distance;

        sparkle.style.setProperty('--tx', tx + 'px');
        sparkle.style.setProperty('--ty', ty + 'px');

        sparkles?.appendChild(sparkle);

        setTimeout(() => sparkle.classList.add('burst'), 50);
        setTimeout(() => sparkle.remove(), 900);
      }
    }

    // Skip animation
    function skipAnimation() {
      if (animationComplete) return;
      animationComplete = true;

      intro.classList.add('fade-out');

      setTimeout(() => {
        intro.classList.add('hidden');
        // Dispatch event to notify Hero component that intro is done (suggestion done by astro, this is smart because i learned this in CSE 134B where we can let one js component talk to another through events )
        window.dispatchEvent(new CustomEvent('introComplete'));
      }, 1000);
    }

    // Start animation sequence
    function startAnimation() {
      // Step 1: Card starts rolling + trail grows
      setTimeout(() => {
        card?.classList.add('rolling');
        trail?.classList.add('active');
      }, 300);

      // Step 2: Text reveals as card moves
      setTimeout(() => {
        text?.classList.add('revealing');
      }, 500);

      // Step 3: Card reaches center, explodes with sparkles
      setTimeout(() => {
        card?.classList.remove('rolling');
        card?.classList.add('exploding');
        createSparkles();
      }, 1800);

      // Step 4: Fade out overlay
      setTimeout(() => {
        if (!animationComplete) {
          animationComplete = true;
          intro.classList.add('fade-out');
        }
      }, 2200);

      // Step 5: Hide overlay and dispatch introComplete event
      setTimeout(() => {
        intro.classList.add('hidden');
        // Dispatch event to notify Hero component that intro is done
        window.dispatchEvent(new CustomEvent('introComplete'));
      }, 3200);
    }

    // Event Listeners
    skipBtn?.addEventListener('click', skipAnimation);

    // Keyboard skip (Escape or Space)
    document.addEventListener('keydown', (e) => {
      if ((e.key === 'Escape' || e.key === ' ') && !animationComplete) {
        e.preventDefault();
        skipAnimation();
      }
    });

    // Start animation
    setTimeout(startAnimation, 200);
  });
</script>
