---
// Navigation component matching the design proposal
// 2D/3D mode toggle (visual placeholder for now)

// Get the current path to highlight active link
const currentPath = Astro.url.pathname;
---

<nav class="nav" id="nav">
  <div class="nav-inner">
    <a href="/" class="nav-logo">
      <div class="logo-mark">N</div>
      <span class="logo-text">Nicholas Chan</span>
    </a>

    <div class="nav-links">
      <a href="/" class={`nav-link ${currentPath === '/' ? 'active' : ''}`}>Home</a>
      <a href="/projects" class={`nav-link ${currentPath === '/projects' || currentPath === '/projects/' ? 'active' : ''}`}>Projects</a>
      <a href="/about" class={`nav-link ${currentPath === '/about' || currentPath === '/about/' ? 'active' : ''}`}>About</a>
      <a href="/#contact" class="nav-link">Contact</a>
    </div>

    <div class="nav-actions">
      <div class="mode-toggle">
        <button class="mode-btn active" id="lightModeBtn" aria-label="Light mode">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
        </button>
        <button class="mode-btn" id="darkModeBtn" aria-label="Dark mode">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
      </div>

      <!-- Hamburger Menu (Mobile Only) -->
      <button class="hamburger" id="hamburger" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobileMenu">
    <div class="mobile-menu-links">
      <a href="/" class={`mobile-menu-link ${currentPath === '/' ? 'active' : ''}`}>Home</a>
      <a href="/projects" class={`mobile-menu-link ${currentPath === '/projects' || currentPath === '/projects/' ? 'active' : ''}`}>Projects</a>
      <a href="/about" class={`mobile-menu-link ${currentPath === '/about' || currentPath === '/about/' ? 'active' : ''}`}>About</a>
      <a href="/#contact" class="mobile-menu-link">Contact</a>
    </div>
  </div>
</nav>

<style>
  .nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    padding: 16px 32px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .nav.scrolled {
    background: rgba(6, 8, 13, 0.8);
    backdrop-filter: blur(20px);
  }

  [data-theme="light"] .nav.scrolled {
    background: rgba(250, 251, 252, 0.85);
  }

  .nav-inner {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .nav-logo {
    display: flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    color: var(--text-primary);
  }

  .logo-mark {
    width: 42px;
    height: 42px;
    background: var(--gradient-bg);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 18px;
    box-shadow: var(--shadow-glow);
    position: relative;
    overflow: hidden;
  }

  .logo-mark::before {
    content: '';
    position: absolute;
    inset: -2px;
    background: var(--gradient-bg);
    border-radius: inherit;
    z-index: -1;
    animation: logoGlow 3s ease-in-out infinite;
  }

  @keyframes logoGlow {
    0%, 100% { opacity: 0.5; filter: blur(8px); }
    50% { opacity: 0.8; filter: blur(12px); }
  }

  .logo-text {
    font-weight: 600;
    font-size: 16px;
    letter-spacing: -0.02em;
  }

  .nav-links {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .nav-link {
    padding: 10px 18px;
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    border-radius: var(--radius-sm);
    transition: all 0.3s ease;
    position: relative;
  }

  .nav-link:hover,
  .nav-link.active {
    color: var(--text-primary);
    background: var(--surface-hover);
  }

  .nav-link::after {
    content: '';
    position: absolute;
    bottom: 6px;
    left: 50%;
    width: 0;
    height: 2px;
    background: var(--gradient-bg);
    border-radius: 2px;
    transition: all 0.3s ease;
    transform: translateX(-50%);
  }

  .nav-link:hover::after {
    width: calc(100% - 36px);
  }

  .nav-actions {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .mode-toggle {
    display: flex;
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-sm);
    padding: 4px;
    gap: 4px;
  }

  .mode-btn {
    padding: 8px 10px;
    border: none;
    background: transparent;
    color: var(--text-muted);
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .mode-btn.active {
    background: var(--gradient-bg);
    color: white;
    box-shadow: 0 2px 12px var(--glow-blue);
  }

  .mode-btn:not(.active):hover {
    color: var(--text-secondary);
    background: var(--surface-hover);
  }

  /* Hamburger Menu (Mobile Only) */
  .hamburger {
    display: none;
    flex-direction: column;
    gap: 4px;
    padding: 8px;
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all 0.3s ease;
    margin-left: 8px;
  }

  .hamburger:hover {
    background: var(--surface-hover);
  }

  .hamburger span {
    width: 20px;
    height: 2px;
    background: var(--text-primary);
    border-radius: 2px;
    transition: all 0.3s ease;
  }

  .hamburger.active span:nth-child(1) {
    transform: rotate(45deg) translate(6px, 6px);
  }

  .hamburger.active span:nth-child(2) {
    opacity: 0;
  }

  .hamburger.active span:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
  }

  /* Mobile Menu */
  .mobile-menu {
    position: fixed;
    top: 64px;
    left: 0;
    right: 0;
    background: var(--bg-secondary);
    border-bottom: 0;
    backdrop-filter: blur(20px);
    z-index: 999;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .mobile-menu.active {
    max-height: 400px;
    border-bottom: 1px solid var(--glass-border);
  }

  .mobile-menu-links {
    display: flex;
    flex-direction: column;
    padding: 16px;
    gap: 8px;
  }

  .mobile-menu-link {
    padding: 12px 16px;
    color: var(--text-secondary);
    font-size: 16px;
    font-weight: 500;
    border-radius: var(--radius-sm);
    transition: all 0.3s ease;
    text-decoration: none;
  }

  .mobile-menu-link:hover,
  .mobile-menu-link.active {
    color: var(--text-primary);
    background: var(--surface-hover);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .nav {
      padding: 12px 16px;
    }

    .logo-mark {
      width: 36px;
      height: 36px;
      font-size: 16px;
    }

    .logo-text {
      font-size: 14px;
    }

    .nav-links {
      display: none;
    }

    .hamburger {
      display: flex;
    }

    .mode-toggle {
      padding: 3px;
      gap: 3px;
    }

    .mode-btn {
      padding: 6px 8px;
    }

    .mode-btn svg {
      width: 14px;
      height: 14px;
    }
  }
</style>

<script>
  // Navbar scroll effect
  const nav = document.getElementById('nav');
  
  window.addEventListener('scroll', () => {
    if (window.scrollY > 50) {
      nav?.classList.add('scrolled');
    } else {
      nav?.classList.remove('scrolled');
    }
  });

  // Theme management
  const getTheme = () => {
    const stored = localStorage.getItem('theme');
    if (stored) return stored;
    return window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
  };

  const setTheme = (theme: 'light' | 'dark') => {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    updateButtonStates(theme);
  };

  const updateButtonStates = (theme: 'light' | 'dark') => {
    const lightBtn = document.getElementById('lightModeBtn');
    const darkBtn = document.getElementById('darkModeBtn');
    
    if (theme === 'light') {
      lightBtn?.classList.add('active');
      darkBtn?.classList.remove('active');
    } else {
      darkBtn?.classList.add('active');
      lightBtn?.classList.remove('active');
    }
  };

  // Initialize theme on load
  const currentTheme = getTheme();
  if (document.documentElement.getAttribute('data-theme') !== currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);
    localStorage.setItem('theme', currentTheme);
  }
  updateButtonStates(currentTheme as 'light' | 'dark');

  // Listen for system theme changes
  window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', (e) => {
    if (!localStorage.getItem('theme')) {
      setTheme(e.matches ? 'light' : 'dark');
    }
  });

  // Toggle buttons
  const lightBtn = document.getElementById('lightModeBtn');
  const darkBtn = document.getElementById('darkModeBtn');
  
  lightBtn?.addEventListener('click', () => {
    setTheme('light');
  });
  
  darkBtn?.addEventListener('click', () => {
    setTheme('dark');
  });

  // Handle contact link click to prevent page reload if already on homepage
  const contactLink = document.querySelector('a[href="/#contact"]');
  if (contactLink) {
    contactLink.addEventListener('click', (e) => {
      // Check if we're on the homepage
      if (window.location.pathname === '/' || window.location.pathname === '') {
        e.preventDefault(); // this is the correct method to prevent reload
        
        // Check if contact section exists (fail safe, not really needed but is included so might as well)
        const contactSection = document.getElementById('contact');
        if (contactSection) {
          // Smooth scroll to contact section
          const navHeight = nav?.offsetHeight || 0;
          const contactTop = contactSection.offsetTop - navHeight - 20;
          
          window.scrollTo({
            top: contactTop,
            behavior: 'smooth'
          });
        }
      }
      // If not on homepage, let the default behavior happen (navigate to /#contact)
    });
  }

  // ================== Mobile Navigation ================== //
  const hamburger = document.getElementById('hamburger');
  const mobileMenu = document.getElementById('mobileMenu');
  const mobileLinks = document.querySelectorAll('.mobile-menu-link');

  hamburger?.addEventListener('click', () => {
    hamburger.classList.toggle('active');
    mobileMenu?.classList.toggle('active');
  });

  mobileLinks.forEach(link => {
    link.addEventListener('click', (e) => {
      const href = link.getAttribute('href');
      
      // Close mobile menu
      hamburger?.classList.remove('active');
      mobileMenu?.classList.remove('active');

      // Handle contact link smooth scroll
      if (href === '/#contact' || href?.startsWith('#contact')) {
        e.preventDefault();
        const contactSection = document.getElementById('contact');
        if (contactSection) {
          const navHeight = nav?.offsetHeight || 0;
          const contactTop = contactSection.offsetTop - navHeight - 20;
          
          window.scrollTo({
            top: contactTop,
            behavior: 'smooth'
          });
        }
      }
    });
  });
</script>
